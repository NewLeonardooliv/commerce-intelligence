# ğŸ“Š Arquitetura MCP - VisualizaÃ§Ã£o

## ğŸ¯ VisÃ£o Geral do Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USUÃRIO / FRONTEND                          â”‚
â”‚                     (Faz perguntas via HTTP API)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CHAT CONTROLLER                               â”‚
â”‚                  POST /api/v1/chat                                   â”‚
â”‚       GET /api/v1/chat/mcp/{tools|health|servers}                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CHAT SERVICE                                 â”‚
â”‚          - Gerencia sessÃµes de conversa                              â”‚
â”‚          - Inicializa MCP Service                                    â”‚
â”‚          - Coordena AgentOrchestrator                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AGENT ORCHESTRATOR                                â”‚
â”‚                    (Pipeline de 6 Agentes)                           â”‚
â”‚                                                                       â”‚
â”‚  1. Interpreter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚       â”‚                                                    â”‚          â”‚
â”‚       â–¼                                                    â”‚          â”‚
â”‚  2. Data Query Agent (PostgreSQL)                         â”‚          â”‚
â”‚       â”‚                                                    â”‚          â”‚
â”‚       â–¼                                                    â”‚          â”‚
â”‚  3. MCP Agent â­ NOVO â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚          â”‚
â”‚       â”‚                        â”‚                           â”‚          â”‚
â”‚       â”‚                   MCP Service                      â”‚          â”‚
â”‚       â”‚                        â”‚                           â”‚          â”‚
â”‚       â”‚                        â”œâ”€> Server 1               â”‚          â”‚
â”‚       â”‚                        â”œâ”€> Server 2               â”‚          â”‚
â”‚       â”‚                        â””â”€> Server N               â”‚          â”‚
â”‚       â”‚                                                    â”‚          â”‚
â”‚       â–¼                                                    â”‚          â”‚
â”‚  4. Responder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚       â”‚                                                    â”‚          â”‚
â”‚       â–¼                                                    â”‚          â”‚
â”‚  5. Suggestion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚       â”‚                                                    â”‚          â”‚
â”‚       â–¼                                                    â”‚          â”‚
â”‚  6. Enhancer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚       â”‚                                                               â”‚
â”‚       â””â”€> Resposta Final                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Fluxo de Dados Detalhado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UsuÃ¡rio     â”‚
â”‚  Query       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. INTERPRETER AGENT            â”‚
â”‚  - Analisa intenÃ§Ã£o              â”‚
â”‚  - Extrai entidades              â”‚
â”‚  - Define requiresData           â”‚
â”‚  - Define requiresExternalTools  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€> interpretation: {
          â”‚      intent: string,
          â”‚      requiresData: boolean,
          â”‚      requiresExternalTools: boolean,
          â”‚      confidence: number
          â”‚    }
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. DATA QUERY AGENT             â”‚
â”‚  - Gera SQL                      â”‚
â”‚  - Executa no PostgreSQL         â”‚
â”‚  - Retorna dados estruturados    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€> queryResults: [
          â”‚      { data from database }
          â”‚    ]
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. MCP AGENT â­                â”‚
â”‚                                  â”‚
â”‚  [DecisÃ£o]                       â”‚
â”‚  - Verifica requiresExternal     â”‚
â”‚  - Identifica keywords           â”‚
â”‚  - Consulta MCP Service          â”‚
â”‚                                  â”‚
â”‚  [SeleÃ§Ã£o]                       â”‚
â”‚  - Lista tools disponÃ­veis       â”‚
â”‚  - Usa IA para escolher tool     â”‚
â”‚  - Extrai parÃ¢metros             â”‚
â”‚                                  â”‚
â”‚  [ExecuÃ§Ã£o]                      â”‚
â”‚  - Chama servidor MCP via HTTP   â”‚
â”‚  - Recebe resultado              â”‚
â”‚  - Adiciona ao contexto          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€> mcpResults: {
          â”‚      tool: string,
          â”‚      server: string,
          â”‚      data: any
          â”‚    }
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. RESPONDER AGENT              â”‚
â”‚  - Analisa dados internos        â”‚
â”‚  - Analisa dados MCP             â”‚
â”‚  - Cria resposta em portuguÃªs    â”‚
â”‚  - Destaca insights              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€> rawResponse: string
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. SUGGESTION AGENT             â”‚
â”‚  - Analisa contexto completo     â”‚
â”‚  - Gera 3 sugestÃµes relevantes   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€> suggestions: string[]
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ENHANCER AGENT               â”‚
â”‚  - Refina resposta               â”‚
â”‚  - Adiciona metadados            â”‚
â”‚  - Calcula confianÃ§a             â”‚
â”‚  - Lista fontes                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESPOSTA FINAL                  â”‚
â”‚  {                               â”‚
â”‚    response: string,             â”‚
â”‚    metadata: {                   â”‚
â”‚      mcpUsed: boolean,           â”‚
â”‚      sources: string[],          â”‚
â”‚      confidence: number,         â”‚
â”‚      suggestions: string[]       â”‚
â”‚    }                             â”‚
â”‚  }                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸŒ MCP Service - Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MCP SERVICE                             â”‚
â”‚                                                              â”‚
â”‚  - Gerencia mÃºltiplos servidores MCP                        â”‚
â”‚  - Cache de tools disponÃ­veis                               â”‚
â”‚  - Health check periÃ³dico                                   â”‚
â”‚  - Retry em falhas                                          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  MCP Client 1  â”‚  MCP Client 2  â”‚  MCP Client N  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚          â”‚                 â”‚                 â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚                 â”‚
           â”‚ HTTP            â”‚ HTTP            â”‚ HTTP
           â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP Server 1   â”‚ â”‚  MCP Server 2   â”‚ â”‚  MCP Server N   â”‚
â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚  Tools:         â”‚ â”‚  Tools:         â”‚ â”‚  Tools:         â”‚
â”‚  - web_search   â”‚ â”‚  - get_weather  â”‚ â”‚  - custom_tool  â”‚
â”‚  - translate    â”‚ â”‚  - get_stock    â”‚ â”‚  - api_call     â”‚
â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚  Resources:     â”‚ â”‚  Resources:     â”‚ â”‚  Resources:     â”‚
â”‚  - docs         â”‚ â”‚  - real-time    â”‚ â”‚  - database     â”‚
â”‚  - files        â”‚ â”‚  - market-data  â”‚ â”‚  - external-api â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”Œ Protocolo MCP HTTP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MCP Client     â”‚                    â”‚   MCP Server     â”‚
â”‚  (Commerce-AI)   â”‚                    â”‚   (External)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                         â”‚
         â”‚  1. GET /health                        â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                         â”‚
         â”‚  200 OK                                 â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                         â”‚
         â”‚  2. POST /tools/list                    â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚  {}                                     â”‚
         â”‚                                         â”‚
         â”‚  { tools: [...] }                       â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                         â”‚
         â”‚  3. POST /tools/call                    â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚  {                                      â”‚
         â”‚    name: "web_search",                  â”‚
         â”‚    arguments: { query: "..." }          â”‚
         â”‚  }                                      â”‚
         â”‚                                         â”‚
         â”‚  {                                      â”‚
         â”‚    content: [                           â”‚
         â”‚      { type: "text", text: "..." }      â”‚
         â”‚    ]                                    â”‚
         â”‚  }                                      â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                         â”‚
```

## ğŸ“¦ Estrutura de Dados

### Context Flow

```typescript
// Input do usuÃ¡rio
{
  message: "Qual o clima em SP?",
  userId: "user123"
}

// ApÃ³s Interpreter
context = {
  userQuery: "Qual o clima em SP?",
  interpretation: {
    intent: "Obter informaÃ§Ãµes de clima",
    requiresData: false,           // NÃ£o precisa do banco
    requiresExternalTools: true,   // Precisa de MCP
    confidence: 0.95
  }
}

// ApÃ³s MCP Agent
context = {
  ...context,
  mcpResults: {
    tool: "get_weather",
    server: "example",
    data: {
      temp: 25,
      condition: "Ensolarado"
    }
  }
}

// ApÃ³s Responder
context = {
  ...context,
  rawResponse: "O clima em SÃ£o Paulo estÃ¡ 25Â°C, Ensolarado."
}

// ApÃ³s Suggestion
context = {
  ...context,
  suggestions: [
    "Qual a previsÃ£o para os prÃ³ximos dias?",
    "E o clima no Rio de Janeiro?",
    "Mostre o histÃ³rico de temperatura"
  ]
}

// Output final
{
  response: "O clima em SÃ£o Paulo estÃ¡ 25Â°C, Ensolarado.",
  metadata: {
    mcpUsed: true,
    sources: ["MCP: example", "AnÃ¡lise de IA"],
    confidence: 0.88,
    suggestions: [...]
  }
}
```

## ğŸ¯ DecisÃ£o de Uso do MCP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Interpreter Result                      â”‚
â”‚  requiresExternalTools: boolean          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  true?   â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â”‚           â”‚
       YES         NO
        â”‚           â”‚
        â”‚           â””â”€â”€> Pula MCP Agent
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lista Tools     â”‚
â”‚  DisponÃ­veis     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IA Decide:      â”‚
â”‚  - Qual tool?    â”‚
â”‚  - ParÃ¢metros?   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Executa Tool    â”‚
â”‚  no Servidor MCP â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Adiciona ao     â”‚
â”‚  Contexto        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ CenÃ¡rios de Uso

### CenÃ¡rio 1: Apenas Dados Internos
```
Pergunta: "Quantos produtos temos?"

Interpreter â†’ requiresData: true, requiresExternal: false
DataQuery   â†’ Executa SQL
MCP         â†’ PULADO
Responder   â†’ Usa queryResults
Output      â†’ "Temos 1000 produtos"
```

### CenÃ¡rio 2: Apenas Dados Externos
```
Pergunta: "Qual o clima em SÃ£o Paulo?"

Interpreter â†’ requiresData: false, requiresExternal: true
DataQuery   â†’ PULADO
MCP         â†’ Chama get_weather
Responder   â†’ Usa mcpResults
Output      â†’ "Clima: 25Â°C, Ensolarado"
```

### CenÃ¡rio 3: Dados Mistos
```
Pergunta: "Quantos produtos temos e qual a tendÃªncia de mercado?"

Interpreter â†’ requiresData: true, requiresExternal: true
DataQuery   â†’ Executa SQL â†’ 1000 produtos
MCP         â†’ Chama web_search â†’ TendÃªncias de mercado
Responder   â†’ Usa queryResults + mcpResults
Output      â†’ "Temos 1000 produtos. TendÃªncias: crescimento 15%..."
```

### CenÃ¡rio 4: ConversaÃ§Ã£o Simples
```
Pergunta: "OlÃ¡, tudo bem?"

Interpreter â†’ requiresData: false, requiresExternal: false
DataQuery   â†’ PULADO
MCP         â†’ PULADO
Responder   â†’ Resposta direta
Output      â†’ "OlÃ¡! Como posso ajudar?"
```

## ğŸ“Š MÃ©tricas e Observabilidade

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LOGGING                              â”‚
â”‚                                                          â”‚
â”‚  [Chat Service] MCP enabled with 3 servers              â”‚
â”‚  [Orchestrator] Running agent: interpreter              â”‚
â”‚  [Orchestrator] Running agent: data_query               â”‚
â”‚  [Orchestrator] Running agent: mcp                      â”‚
â”‚  [MCP Agent] Processing...                              â”‚
â”‚  [MCP Agent] Successfully executed tool: web_search     â”‚
â”‚  [Orchestrator] Running agent: responder                â”‚
â”‚  [Orchestrator] Running agent: suggestion               â”‚
â”‚  [Orchestrator] Running agent: enhancer                 â”‚
â”‚  [Orchestrator] Processing complete                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PERFORMANCE                            â”‚
â”‚                                                          â”‚
â”‚  Interpreter:    200ms   â–ˆâ–ˆâ–ˆâ–ˆ                            â”‚
â”‚  Data Query:     500ms   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                      â”‚
â”‚  MCP Agent:      400ms   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                        â”‚
â”‚  Responder:      300ms   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                          â”‚
â”‚  Suggestion:     200ms   â–ˆâ–ˆâ–ˆâ–ˆ                            â”‚
â”‚  Enhancer:       200ms   â–ˆâ–ˆâ–ˆâ–ˆ                            â”‚
â”‚                                                          â”‚
â”‚  Total:          1800ms  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    METADATA                              â”‚
â”‚                                                          â”‚
â”‚  {                                                       â”‚
â”‚    dataUsed: boolean,        // Usou PostgreSQL         â”‚
â”‚    mcpUsed: boolean,         // Usou MCP                â”‚
â”‚    sources: string[],        // ["DB", "MCP: X"]        â”‚
â”‚    confidence: number,       // 0.0 - 1.0               â”‚
â”‚    suggestions: string[],    // PrÃ³ximas perguntas      â”‚
â”‚    interpretation: {...}     // Detalhes da anÃ¡lise     â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**VersÃ£o**: 2.0.0 (com MCP)  
**Data**: 2026-01-25  
**Agentes**: 6 (Interpreter, DataQuery, MCP, Responder, Suggestion, Enhancer)
